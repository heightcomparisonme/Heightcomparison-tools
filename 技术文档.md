# HeightComparison 项目技术文档

## 项目概述

**HeightComparison** 是一个基于 Next.js 15 的现代化身高比较工具网站。用户可以通过直观的可视化图表比较不同人物、角色或对象的身高，支持自定义添加人物和从丰富的角色数据库中选择。

### 核心功能
- 📏 **实时身高可视化比较**：支持多人同时比较，自动按比例缩放
- 🎭 **角色数据库**：包含明星、动漫角色、虚构人物等多种类型
- 🎨 **可定制的视觉元素**：颜色、头像、PNG 图片支持
- 📊 **数据管理**：导入/导出功能，统计分析
- 📱 **响应式设计**：支持桌面端和移动端

---

## 技术架构

### 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **Next.js** | 15.3.2 | React 框架，SSG 静态生成 |
| **React** | 18.3.1 | 用户界面库 |
| **TypeScript** | 5.8.3 | 类型安全的 JavaScript |
| **Tailwind CSS** | 3.4.17 | 原子化 CSS 框架 |
| **Radix UI** | 2.x | 无障碍的 UI 组件库 |
| **Lucide React** | 0.475.0 | 图标库 |

### 后端/数据层

| 技术 | 用途 |
|------|------|
| **Supabase** | PostgreSQL 数据库即服务 |
| **GitHub** | 静态资源托管（角色图片） |

### 开发工具

| 工具 | 用途 |
|------|------|
| **Biome** | 代码格式化和检查 |
| **ESLint** | JavaScript/TypeScript 代码检查 |
| **Bun** | 包管理器和运行时 |

---

## 项目结构

```
src/
├── app/                     # Next.js App Router
│   ├── layout.tsx          # 根布局组件
│   ├── page.tsx            # 首页
│   ├── globals.css         # 全局样式
│   └── ClientBody.tsx      # 客户端组件容器
├── components/             # React 组件
│   ├── ui/                 # 基础 UI 组件
│   │   ├── button.tsx
│   │   ├── card.tsx
│   │   ├── input.tsx
│   │   ├── select.tsx
│   │   ├── switch.tsx
│   │   └── tabs.tsx
│   ├── CharacterAvatar.tsx      # 角色头像组件
│   ├── CharacterDatabase.tsx    # 角色数据库组件
│   ├── ControlPanel.tsx         # 控制面板
│   ├── DataManager.tsx          # 数据管理器
│   ├── Header.tsx               # 页面头部
│   ├── Footer.tsx               # 页面底部
│   ├── PersonForm.tsx           # 人物表单
│   ├── SampleData.tsx           # 示例数据
│   └── VisualizationChart.tsx   # 可视化图表（核心组件）
├── contexts/
│   └── HeightContext.tsx        # 全局状态管理
├── lib/
│   ├── supabase.ts             # Supabase 客户端配置
│   ├── supabaseService.ts      # 数据库服务
│   └── utils.ts                # 工具函数
└── data/
    └── charactersData.ts       # 角色数据类型定义
```

---

## 核心组件详解

### 1. HeightContext（状态管理）

**文件**：`src/contexts/HeightContext.tsx`

**核心功能**：
- 管理当前比较的人物列表
- 提供添加、删除、更新人物的方法
- 支持单位切换（cm/ft）
- 使用 React Context API 实现全局状态共享

**主要接口**：
```typescript
interface Person {
  id: string
  name: string
  height: number        // 厘米
  gender: 'male' | 'female' | 'other'
  color: string        // 十六进制颜色
  imageUrl?: string    // 可选的图片 URL
}

interface HeightContextType {
  people: Person[]
  addPerson: (person: Omit<Person, 'id'>) => void
  removePerson: (id: string) => void
  clearAll: () => void
  updatePerson: (id: string, updates: Partial<Person>) => void
  unit: 'cm' | 'ft'
  setUnit: (unit: 'cm' | 'ft') => void
}
```

### 2. VisualizationChart（可视化图表）

**文件**：`src/components/VisualizationChart.tsx`

**核心功能**：
- SVG 绘制的身高比较图表
- 支持拖拽添加角色
- 自动比例缩放（最高 260cm）
- 双标尺显示（厘米和英尺）
- PNG 图片和几何图形 fallback 支持

**技术特点**：
- 使用 SVG 确保矢量图形的清晰度
- 动态计算图表宽度适应内容
- 错误处理：图片加载失败时显示备用图形
- 地面基线和网格背景

### 3. CharacterDatabase（角色数据库）

**文件**：`src/components/CharacterDatabase.tsx`

**核心功能**：
- 从 Supabase 数据库获取角色数据
- 分类浏览（明星、动漫、通用等）
- 实时搜索功能
- 角色头像显示

**数据结构**：
```typescript
interface AppCharacter {
  id: string
  name: string
  height: number           // 厘米
  category: string
  subcategory?: string
  gender: 'male' | 'female' | 'other'
  imageUrl: string
  thumbnailUrl?: string
  color?: string
  description?: string
  source?: string
}
```

### 4. DataManager（数据管理器）

**文件**：`src/components/DataManager.tsx`

**核心功能**：
- 显示数据库统计信息
- 全数据搜索
- 数据导出（JSON/CSV）
- 拖拽功能支持

---

## 数据库设计

### Supabase 数据库表结构

#### characters 表
```sql
CREATE TABLE characters (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  height NUMERIC NOT NULL,          -- 以米为单位
  cat_ids INTEGER[],                -- 分类 ID 数组
  media_type TEXT,
  media_url TEXT,                   -- 角色图片 URL
  thumbnail_url TEXT,
  color TEXT,
  color_customizable BOOLEAN,
  color_property TEXT,
  order_num INTEGER,
  gender TEXT,
  description TEXT,
  source TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### categories 表
```sql
CREATE TABLE categories (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  path TEXT NOT NULL,
  pid INTEGER REFERENCES categories(id),  -- 父分类 ID
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### 数据分类体系

| ID | 分类名称 | 描述 |
|----|----------|------|
| 1 | Generic | 通用参考人物（平均身高等） |
| 2 | Celebrity | 明星名人 |
| 3 | Anime | 动漫角色 |
| 4 | Fictional | 虚构角色 |
| 5 | Animals | 动物 |
| 6 | Objects | 物体 |

---

## 已实现的功能模块

### ✅ 核心功能

1. **身高比较可视化**
   - SVG 绘制的动态图表
   - 支持多人同时比较
   - 实时比例缩放
   - 双单位标尺（cm/ft）

2. **人物管理**
   - 手动添加自定义人物
   - 从数据库选择预设角色
   - 拖拽式交互
   - 颜色和头像定制

3. **角色数据库**
   - 1000+ 预设角色数据
   - 分类浏览和搜索
   - 明星、动漫、虚构角色等多类型
   - GitHub 托管的高质量 PNG 图片

4. **数据管理**
   - 统计信息展示
   - JSON/CSV 导出功能
   - 全文搜索
   - 缓存优化

### ✅ 用户体验

1. **响应式设计**
   - 移动端优化
   - 触摸操作支持
   - 自适应布局

2. **交互功能**
   - 拖拽添加角色
   - 一键快速操作
   - 示例数据快速加载
   - 实时预览

3. **视觉定制**
   - 6 种预设颜色
   - 角色头像支持
   - PNG 图片显示
   - 优雅的 fallback 机制

---

## 未来功能规划

### 🚀 短期目标（1-3个月）

1. **增强的可视化功能**
   - 导出高质量图片（PNG/SVG）
   - 分享功能（社交媒体）
   - 打印优化模式
   - 全屏浏览模式

2. **更多角色类型**
   - 历史人物
   - 体育明星
   - 政治人物
   - 建筑物和地标

3. **用户账户系统**
   - 用户注册/登录
   - 个人收藏夹
   - 自定义角色保存
   - 比较历史记录

4. **互动功能**
   - 角色详情页面
   - 评论和评分系统
   - 用户上传角色
   - 社区贡献机制

### 🎯 中期目标（3-6个月）

1. **高级分析功能**
   - 身高分布统计
   - 趋势分析图表
   - 对比报告生成
   - 数据可视化仪表板

2. **AI 增强功能**
   - 智能角色推荐
   - 相似身高查找
   - 自动分类
   - 图片识别身高

3. **多媒体支持**
   - 3D 模型展示
   - 动画效果
   - 视频比较
   - AR/VR 体验

4. **国际化**
   - 多语言支持
   - 地区化数据
   - 本地化身高标准
   - 文化相关角色

### 🌟 长期愿景（6-12个月）

1. **平台化发展**
   - API 开放
   - 第三方集成
   - 移动应用
   - 桌面客户端

2. **企业功能**
   - 团队协作
   - 白标解决方案
   - 商业数据分析
   - 高级权限管理

3. **教育应用**
   - 教学工具包
   - 课程集成
   - 学习分析
   - 互动教育内容

---

## 技术债务和优化方向

### 🔧 性能优化

1. **图片加载优化**
   - 懒加载实现
   - WebP 格式支持
   - CDN 集成
   - 缓存策略优化

2. **数据查询优化**
   - 分页加载
   - 索引优化
   - 查询缓存
   - 减少 API 调用

3. **包体积优化**
   - 代码分割
   - Tree shaking
   - 依赖项优化
   - 构建优化

### 🛡️ 安全性增强

1. **数据安全**
   - 输入验证
   - XSS 防护
   - CSRF 保护
   - Rate limiting

2. **隐私保护**
   - GDPR 合规
   - 数据加密
   - 审计日志
   - 权限控制

### 🧪 测试覆盖

1. **自动化测试**
   - 单元测试（Jest）
   - 集成测试（Testing Library）
   - E2E 测试（Playwright）
   - 视觉回归测试

2. **代码质量**
   - 更严格的 TypeScript 配置
   - 代码覆盖率提升
   - 性能监控
   - 错误追踪

---

## 部署和运维

### 当前部署配置

**构建配置**：`next.config.js`
```javascript
const nextConfig = {
  output: 'export',           // 静态导出
  distDir: 'out',            // 输出目录
  images: {
    unoptimized: true,       // 禁用图片优化
    domains: [               // 允许的图片域名
      "raw.githubusercontent.com",
      "images.unsplash.com"
    ]
  }
}
```

**部署平台**：
- 支持 Netlify、Vercel、GitHub Pages
- 静态网站托管
- 自动 CI/CD 集成

### 监控和分析

1. **性能监控**
   - Core Web Vitals
   - 加载时间分析
   - 错误率监控
   - 用户行为分析

2. **业务指标**
   - 活跃用户数
   - 功能使用率
   - 转化率分析
   - 留存率跟踪

---

## 开发环境设置

### 本地开发

```bash
# 安装依赖
bun install

# 启动开发服务器
bun run dev

# 代码格式化
bun run format

# 类型检查和代码检查
bun run lint

# 构建生产版本
bun run build
```

### 环境变量

```env
# Supabase 配置
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# 可选配置
NEXT_PUBLIC_GA_ID=your_google_analytics_id
```

### 代码规范

- **TypeScript**：严格模式，完整类型定义
- **ESLint**：Next.js 推荐配置
- **Biome**：统一的代码格式化
- **命名约定**：PascalCase 组件，camelCase 函数

---

## 总结

HeightComparison 项目是一个功能完善的现代化 Web 应用，采用了当前最佳的技术栈和开发实践。项目具有良好的架构设计、丰富的功能特性和清晰的发展路线图。

### 项目亮点

1. **技术先进性**：使用 Next.js 15、React 18、TypeScript 等最新技术
2. **用户体验优秀**：响应式设计、直观交互、丰富的视觉效果
3. **数据丰富**：1000+ 角色数据库，涵盖多个类别
4. **扩展性强**：模块化架构，便于功能扩展
5. **性能优异**：静态生成、图片优化、缓存策略

### 商业价值

- **教育应用**：身高教学、科学展示
- **娱乐价值**：角色比较、社交分享
- **实用工具**：设计规划、空间测量
- **数据分析**：统计研究、趋势分析

该项目展现了现代 Web 开发的最佳实践，具备良好的可维护性和可扩展性，为未来的功能迭代和商业化发展奠定了坚实的基础。

---

*文档版本：v1.0*  
*更新时间：2025年1月*  
*作者：HeightComparison 开发团队*

